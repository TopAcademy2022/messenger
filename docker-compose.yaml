services:
    main:
        container_name: messanger-server
        build:
            dockerfile: Dockerfile
        env_file:
            - .env
        environment:
            DATABASE_SERVER_NAME: ${DATABASE_SERVER_NAME}
            DATABASE_PORT: ${DATABASE_PORT}
            USER_NAME: ${USER_NAME}
            USER_PASSWORD: ${USER_PASSWORD}
        ports:
            - ${APPLICATION_PORT}:${CONTAINER_PORT}
        depends_on:
            - mssql
        restart: always
    mssql:
        container_name: database-mssql
        image: mcr.microsoft.com/mssql/server:${MSSQL_VERSION}
        env_file:
            - .env
        environment:
            - ACCEPT_EULA=Y
            - SA_PASSWORD=${USER_PASSWORD}
        ports:
            - ${EXPORT_DATABASE_PORT}:1433
        restart: always
        volumes:
            - mssql-data:/var/opt/mssql
    twportainer:
        image: portainer/portainer-ce:latest
        container_name: twportainer
        environment:
            - TZ=Europe/Moscow
        volumes:
            - /var/run/docker.sock:/var/run/docker.sock
            - /opt/twportainer/portainer_data:/data
        ports:
            - "8000:8000"
            - "9443:9443"
        restart: always

volumes:
    mssql-data:
        driver: local
